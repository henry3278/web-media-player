# 媒体播放器插件 - 完整详细功能说明

## 📋 功能概述

这是一个功能丰富的媒体播放器插件，支持在线媒体和本地视频播放，具有智能权重管理、预览记忆、播放记忆等高级功能。

## 🎯 主要功能

### 1. 媒体播放功能
- **多格式支持**：
  - 图片格式：JPG、JPEG、PNG、GIF、WebP、BMP、SVG、ICO、TIFF、TIF
  - 视频格式：MP4、WebM、OGG、MOV、AVI、MKV、WMV、MPG、MPEG、3GP
  - 其他格式：M3U8、FLV等流媒体格式
- **播放模式**：
  - 顺序播放：按列表顺序播放
  - 随机播放：基于权重算法的智能随机播放
- **播放记忆**：
  - 记住上次播放的媒体和播放位置
  - 支持断点续播功能
  - 区分在线媒体和本地视频的记忆
  - 浏览器刷新记忆重置
- **全屏播放**：PC端支持全屏模式，移动端优化防止自动全屏

### 2. 本地媒体管理
- **本地视频支持**：
  - 支持上传和播放本地视频文件
  - 自动识别视频格式
  - 支持单个文件添加和文件夹批量导入
- **智能筛选**：
  - 自动过滤非视频文件
  - 支持文件名和路径搜索
  - 超过数量限制时自动随机筛选
- **预览功能**：
  - 支持本地视频预览播放
  - 预览窗口内支持上一个/下一个切换
  - 自动播放和自动切换功能

### 3. 权重管理系统
- **域名权重**：
  - 按顶级域名设置播放权重（0-100）
  - 默认权重为50
  - 权重0：该域名下所有URL都不播放
  - 权重100：只播放该域名下的URL（唯一性限制）
- **智能过滤**：
  - 权重为0的域名自动跳过
  - 权重100的域名具有播放独占性
- **备注功能**：
  - 为域名添加备注信息
  - 支持备注搜索和编辑
- **权重算法**：
  - 随机播放时按域名权重概率抽取
  - 先选域名，再从域名内随机选URL

### 4. 预览记忆系统
- **分标签记忆**：
  - 全部标签页：记忆最后预览的URL
  - 图片标签页：记忆最后预览的图片URL
  - 视频标签页：记忆最后预览的视频URL
  - 其他标签页：记忆最后预览的其他格式URL
- **本地视频记忆**：
  - 记忆最后预览的本地视频路径
  - 在列表中高亮显示最后预览项
- **自动保存**：
  - 预览记忆自动保存到缓存
  - 浏览器重新打开后记忆仍然存在

### 5. 高级功能
- **URL管理**：
  - 批量导入：支持文本粘贴和文件导入
  - 智能去重：自动去除重复URL
  - URL验证：检测URL可用性
  - 导出功能：导出URL列表到文件
- **缓存优化**：
  - 视频预加载：提前加载下一个视频
  - URL验证缓存：缓存检测结果提升性能
  - 智能缓存清理：自动管理缓存大小
- **响应式设计**：
  - 完美适配PC端和移动端
  - 触摸优化的交互体验
- **拖拽操作**：
  - 播放器可拖拽移动位置
  - 播放键可拖拽调整位置
  - 自动保存位置信息

## 📖 详细使用说明

### 基本操作
1. **启动播放器**：
   - 点击页面上的浮动播放键（默认位置左上角）
   - 播放键支持拖拽移动，位置自动记忆

2. **控制播放**：
   - PC端：双击播放器切换下一个媒体
   - 移动端：双击播放器切换下一个媒体
   - 视频播放时显示控制条，支持进度拖动
   - 支持全屏播放（仅PC端）

3. **播放器交互**：
   - 鼠标悬停：播放器轻微放大效果
   - 拖动：可移动播放器位置
   - 视频控制：进度条、时间显示、全屏按钮

### 媒体管理详细操作

#### 在线媒体管理
1. **添加URL**：
   - 在"在线媒体"标签页使用批量导入功能
   - 支持直接粘贴URL列表（每行一个）
   - 支持从文件导入（txt、csv、json、excel等格式）
   - 自动识别和提取文本中的URL

2. **URL验证**：
   - 点击"检测URL"验证当前列表URL可用性
   - 显示图片、视频、其他格式的验证统计
   - 失效URL会用红色标记

3. **URL清理**：
   - "清除失效URL"：删除所有验证失败的URL
   - "清除列表URL"：删除当前搜索过滤后显示的URL
   - "清除所有URL"：清空整个URL列表

#### 本地视频管理
1. **添加视频**：
   - **单个添加**：点击"添加视频"选择单个视频文件
   - **文件夹批量添加**：点击"随机抽取"选择文件夹
   - **格式支持**：MP4、WebM、OGG、MOV、AVI、MKV、WMV、MPG、MPEG、3GP

2. **随机抽取功能**：
   - 选择文件夹后自动扫描所有子文件夹
   - 识别所有视频格式文件
   - 如果视频数量超过最大限制，会自动随机筛选
   - 筛选后保留指定数量的视频文件

3. **视频预览**：
   - 点击视频列表中的项目打开预览窗口
   - 预览窗口支持播放控制
   - 自动播放和自动切换到下一个视频
   - 支持删除当前预览的视频

### 权重设置详细操作

1. **权重设置**：
   - 在权重列表中找到目标域名
   - 在权重输入框中输入0-100的数值
   - 权重100只能设置一个域名
   - 权重0会完全过滤该域名下的URL

2. **备注管理**：
   - 点击域名或备注文字打开编辑窗口
   - 输入备注信息后保存
   - 备注信息支持搜索

3. **权重重置**：
   - 点击"重置权重"将所有域名权重恢复为50
   - 需要确认操作，防止误操作

## ⚠️ 重要注意事项

### 🔴 本地视频重要限制

#### 浏览器刷新问题
- **关键限制**：浏览器刷新或重新打开页面时，**本地视频列表会自动清空**
- **原因说明**：出于浏览器安全限制，File对象无法在页面刷新后保持
- **解决方案**：
  1. 需要重新选择视频文件
  2. 建议将重要视频文件保存在固定位置
  3. 使用"随机抽取"功能快速重新添加文件夹

#### 文件数量限制
- **默认限制**：最大50个本地视频
- **可调整范围**：1-500个（在设置中调整）
- **超过限制处理**：
  - 添加时如果超过限制，会自动随机筛选
  - 保留指定数量的视频文件
  - 显示警告提示用户

#### 文件大小限制
- **无明确大小限制**，但受浏览器内存限制
- **建议**：单个视频文件不要过大，避免内存问题
- **统计显示**：显示所有视频的总文件大小

### 🟡 权重设置注意事项

#### 权重100的特殊规则
- **唯一性**：只能有一个域名设置为权重100
- **独占播放**：设置权重100后，只播放该域名下的URL
- **优先级**：权重100优先于其他所有权重设置

#### 权重0的影响
- **完全过滤**：权重0的域名下所有URL都不会播放
- **顺序播放**：顺序播放时会自动跳过权重0的域名
- **随机播放**：随机播放时根本不会考虑权重0的域名

### 🟠 URL管理注意事项

#### 数量限制
- **默认上限**：5000个URL
- **可调整范围**：100-15000个
- **超过限制处理**：智能随机筛选，保留指定数量的URL

#### URL验证
- **验证时间**：每个URL验证可能需要几秒钟
- **网络依赖**：验证需要网络连接
- **缓存机制**：验证结果会缓存，提升后续性能

### 🔵 播放记忆限制

#### 记忆范围
- **在线媒体**：记忆URL和播放时间
- **本地视频**：记忆文件路径和播放时间
- **刷新丢失**：本地视频的播放记忆在刷新后失效（因为文件需要重新选择）

#### 记忆触发
- **自动保存**：播放停止时自动保存记忆
- **手动清除**：切换到下一个媒体时清除记忆
- **媒体类型切换**：切换媒体类型时清除记忆
- **浏览器刷新** 浏览器刷新后清除记忆

#### 缓存存储
- **配置数据**：所有用户设置和选项
- **URL列表**：所有在线媒体URL
- **权重设置**：域名权重和备注信息
- **预览记忆**：各标签页最后预览的URL
- **位置信息**：播放器和播放键的位置
- **本地视频元数据**：文件名、路径、大小、修改时间等
- **注意**：不存储实际的File对象（安全限制），自己导出备份设置防止浏览器缓存清空数据丢失。

### 🏠 主设置标签页

#### 基本设置板块
- **启用播放器**：
  - 全局开关，控制整个播放器功能的启用状态
  - 关闭时隐藏浮动播放键，停止所有播放

- **媒体类型**：
  - **在线混合**：播放所有类型的在线媒体（图片+视频+其他）
  - **在线图片**：只播放图片格式的URL
  - **在线视频**：只播放视频格式的URL（包含其他流媒体格式）
  - **本地视频**：只播放本地视频文件

- **播放模式**：
  - **顺序播放**：按URL列表顺序逐个播放
  - **随机播放**：基于权重算法的智能随机播放

- **视频静音**：
  - 控制视频播放时是否默认静音
  - 不影响系统音量设置

- **播放记忆**：
  - 开启：记住上次播放位置，支持断点续播
  - 关闭：每次从头开始播放

- **播放键大小**：
  - 小：35px - 适合紧凑界面
  - 中：50px - 默认大小
  - 大：65px - 更易点击
  - 特大：80px - 非常醒目

- **播放键颜色**：
  - **默认**：固定的蓝紫色渐变
  - **随机**：每次刷新生成随机渐变颜色

#### 显示设置板块
- **播放器透明度**：
  - 范围：10%-100%
  - 控制播放器背景和媒体内容的透明度
  - 不影响控制条的可见性

- **控制条透明度**：
  - 范围：10%-100%
  - 控制视频播放时底部控制条的透明度
  - 较高的透明度让控制条更不明显

- **播放器宽度**：
  - 范围：200-800像素
  - 高度会根据媒体比例自动计算
  - 移动端会自动适配屏幕宽度

- **图片切换间隔**：
  - 范围：500-10000毫秒（0.5-10秒）
  - 仅对图片播放有效
  - 视频播放不受此设置影响

#### 缓存统计板块
实时显示：
- **在线媒体缓存**：URL验证缓存和视频预加载缓存大小
- **本地媒体缓存**：本地视频元数据缓存大小
- **配置数据缓存**：所有设置数据的存储大小
- **总计占用**：所有缓存的总大小

#### 操作按钮板块
- **保存设置**：立即保存所有修改的设置到本地存储
- **测试播放**：快速测试播放器是否正常工作
- **备份设置**：导出当前所有设置到JSON文件（排除本地视频文件）
- **恢复设置**：从备份文件恢复所有设置（会清空当前设置）
- **重置播放键位置**：将浮动播放键恢复到默认位置（50px, 50px）
- **重置播放器位置**：将媒体播放器恢复到默认位置（10px, 10px）

### 🌐 在线媒体标签页

#### URL统计板块
实时显示四种统计信息：
- **总计URL**：当前URL列表的总数量
- **图片URL**：识别为图片格式的URL数量
- **视频URL**：识别为视频格式的URL数量
- **其它URL**：不属于图片和视频的其他格式URL数量

#### URL上限设置板块
- **总URL上限**：
  - 范围：100-15000个URL
  - 最小值动态调整，不会低于当前URL数量
  - 超过限制时会自动进行智能随机筛选

#### 搜索功能板块
- **实时搜索**：输入关键词即时过滤URL列表
- **搜索范围**：搜索URL地址内容
- **清空搜索**：清空搜索框显示所有URL

#### URL管理板块

**标签页导航**：
- **全部**：显示所有URL，不进行类型过滤
- **图片**：只显示图片格式的URL
- **视频**：只显示视频格式的URL  
- **其它**：只显示其他格式的URL（视频url但没有明确后缀）

**上次预览按钮**：
- **功能**：快速定位并高亮当前标签页最后预览的URL
- **视觉反馈**：
  - 实线边框：当前标签页有预览记忆
  - 虚线边框：当前标签页无预览记忆
- **操作**：点击后滚动到该URL并高亮显示

**URL列表**：
- **显示内容**：URL地址和类型标识
- **交互功能**：点击URL打开预览窗口
- **视觉标识**：最后预览的URL有特殊背景高亮

**操作按钮组**：
- **检测URL**：
  - 验证当前显示列表的所有URL可用性
  - 显示详细的验证统计结果
  - 需要网络连接，可能需要较长时间

- **清除失效URL**：
  - 删除所有验证失败的URL
  - 基于URL验证缓存的结果

- **清除列表URL**：
  - 删除当前搜索和过滤后显示的URL
  - 会弹出确认对话框，操作不可撤销

- **清除所有URL**：
  - 清空整个URL列表
  - 会弹出确认对话框，操作不可撤销

- **导出URL**：
  - 导出所有URL到文本文件
  - 每行一个URL，纯文本格式

#### 批量导入板块

**URL输入框**：
- **多行文本**：支持粘贴大量URL
- **自动格式**：每行一个URL，支持各种分隔符
- **容量警告**：超过上限时会显示警告

**操作按钮**：
- **追加导入**：
  - 将输入框中的URL添加到现有列表
  - 自动去重，不重复添加已有URL
  - 超过上限时自动智能筛选

- **覆盖导入**：
  - 用输入框中的URL替换整个现有列表
  - 会弹出确认对话框
  - 超过上限时自动智能筛选

- **识别URL**：
  - 从任意文本中自动提取URL
  - 支持各种文本格式和分隔符
  - 提取后填充到输入框

**文件导入区域**：
- **支持格式**：TXT、CSV、TSV、JSON、Excel（XLS/XLSX）
- **拖拽支持**：可以直接拖拽文件到区域
- **自动解析**：从文件中自动提取URL
- **视觉反馈**：拖拽时显示高亮状态

### 📁 本地媒体标签页

#### 本地媒体统计板块
显示三个关键统计：
- **当前视频数**：当前已添加的本地视频数量
- **最大视频数**：允许的最大视频数量（可设置）
- **总大小**：所有本地视频文件的总大小

#### 视频数量设置板块
- **最大视频数量**：
  - 范围：1-500个视频
  - 默认值：50个
  - 即时生效，影响后续添加操作

#### 搜索功能板块
- **实时搜索**：输入关键词搜索本地视频
- **搜索范围**：视频文件名和路径
- **多语言支持**：支持中文、英文等文件名搜索

#### 本地视频管理板块

**操作按钮组**：
- **添加视频**：
  - 选择单个视频文件添加到列表
  - 支持所有常见视频格式
  - 自动检查重复文件

- **随机抽取**：
  - 选择文件夹，自动扫描所有子文件夹
  - 识别所有视频文件
  - 超过数量限制时自动随机筛选
  - 显示扫描进度和结果

- **清除全部**：
  - 删除所有本地视频
  - 弹出确认对话框
  - 停止当前播放的本地视频

**本地视频列表**：
- **显示内容**：视频文件名和文件大小
- **交互功能**：点击视频打开预览窗口
- **视觉标识**：最后预览的视频有特殊边框高亮
- **文件信息**：显示格式化后的文件大小

### ⚖️ 播放权重标签页

#### 权重统计板块
显示四个关键统计：
- **总域名数**：URL列表中提取出的唯一域名数量
- **已设置权重**：明确设置了权重（非默认50）的域名数量
- **权重100**：设置为权重100的域名数量（通常为0或1）
- **已备注**：添加了备注信息的域名数量

#### 权重说明板块
详细解释权重系统的所有规则：

**权重值含义**：
- **默认权重**：50 - 未明确设置时的默认值
- **权重范围**：0-100 - 可设置的权重范围
- **权重为0**：该域名下所有URL都不播放（完全过滤）
- **权重为100**：只播放该域名下的URL（独占播放）

**算法说明**：
- **随机播放算法**：先按顶级域名权重抽取域名，再从该域名中随机选择URL
- **权重100限制**：只能设置一个域名，具有最高优先级
- **域名提取**：自动提取顶级域名（如 sss.xxx.com → xxx.com）
- **备注功能**：点击域名或备注文字可编辑备注信息

#### 搜索功能板块
- **实时搜索**：输入关键词搜索域名或备注
- **搜索范围**：域名名称和备注内容
- **多关键词**：支持模糊搜索

#### 权重管理板块

**权重列表**：
- **域名信息**：
  - 显示顶级域名
  - 显示该域名下的URL数量
  - 点击域名可编辑备注

- **备注信息**：
  - 显示域名备注内容
  - "无备注"时显示提示文字
  - 点击备注可编辑

- **权重控制**：
  - **权重输入框**：输入0-100的权重值
  - **实时生效**：输入后立即应用权重设置
  - **输入验证**：自动限制在0-100范围内

- **权重徽章**：
  - 显示当前权重值
  - 实时更新反映输入框的值
  - 视觉化权重数值

**操作按钮**：
- **刷新列表**：重新加载权重列表，反映最新的URL变化
- **重置权重**：将所有域名权重恢复为默认值50（需要确认）

## 🎨 界面设计与交互

### 视觉设计原则
- **极简主义**：清晰的线条，简洁的布局，减少视觉噪音
- **一致性**：统一的颜色方案、图标风格和交互模式
- **层次感**：通过颜色、大小和间距建立清晰的信息层次
- **反馈性**：所有操作都有明确的视觉或文字反馈

### 颜色方案
- **主色调**：蓝紫色渐变（默认播放键颜色）
- **状态颜色**：
  - 成功：绿色系 - 操作成功提示
  - 警告：黄色系 - 需要注意的提示
  - 错误：红色系 - 操作失败或错误
  - 信息：蓝色系 - 一般信息提示
- **交互状态**：
  - 悬停：轻微的缩放和阴影效果
  - 激活：颜色加深或边框变化
  - 禁用：降低透明度和饱和度

### 动效设计
- **平滑过渡**：所有状态变化都有平滑的动画过渡
- **微交互**：按钮点击、开关切换等都有细微的动效
- **加载状态**：长时间操作显示进度指示
- **视觉反馈**：操作成功或失败有明确的视觉确认

## 🔄 数据管理与兼容性

### 数据持久化详情

#### LocalStorage数据
- **配置数据**（minimal_media_config）：
  - 所有用户设置和选项
  - 媒体URL列表
  - 域名权重和备注
  - 本地视频元数据（不包括文件对象）

- **位置信息**：
  - media_player_position：播放器位置坐标
  - media_button_position：播放键位置坐标

- **预览记忆**（media_player_preview_memory）：
  - 各标签页最后预览的URL
  - 本地视频最后预览路径

#### IndexedDB数据
- **数据库名称**：MediaPlayerDB
- **存储表**：localVideos
- **存储内容**：
  - 本地视频的元数据（id、path、name、size、lastModified）
  - 注意：不存储File对象（浏览器安全限制）

### 浏览器兼容性

#### 完全支持的浏览器
- Chrome 60+
- Firefox 55+
- Safari 11+
- Edge 79+

#### 功能限制
- **本地文件**：所有浏览器刷新后都需要重新选择
- **IndexedDB**：部分旧版本浏览器可能支持不完整
- **全屏API**：移动端浏览器限制自动全屏

#### 移动端适配
- **触摸优化**：专门优化的触摸事件处理
- **视图适配**：自动调整布局适应小屏幕
- **性能优化**：移动端特定的性能优化措施

## 📱 移动端特殊处理

### 交互优化
- **触摸事件**：优化的触摸识别，防止误操作
- **双击检测**：专门的双击/双触识别算法
- **手势支持**：基本的滑动手势支持

### 界面适配
- **响应式布局**：自动调整元素大小和间距
- **触摸目标**：确保所有交互元素有足够大的触摸区域
- **键盘回避**：输入时自动调整界面避免键盘遮挡

### 性能优化
- **内存管理**：及时清理资源，防止内存泄漏
- **渲染优化**：减少不必要的重绘和回流
- **网络优化**：智能的预加载和缓存策略

这个插件提供了完整的媒体播放解决方案，结合了强大的管理功能和优秀的用户体验，适合各种媒体播放需求。特别注意本地视频在浏览器刷新时的限制，这是出于浏览器安全性的必要限制。
